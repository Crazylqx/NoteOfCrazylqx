# 概论
- [概论](#%e6%a6%82%e8%ae%ba)
  - [结构和功能](#%e7%bb%93%e6%9e%84%e5%92%8c%e5%8a%9f%e8%83%bd)
  - [冯·诺依曼机](#%e5%86%af%e8%af%ba%e4%be%9d%e6%9b%bc%e6%9c%ba)
  - [计算机系统的性能设计](#%e8%ae%a1%e7%ae%97%e6%9c%ba%e7%b3%bb%e7%bb%9f%e7%9a%84%e6%80%a7%e8%83%bd%e8%ae%be%e8%ae%a1)
    - [微处理器的性能提升](#%e5%be%ae%e5%a4%84%e7%90%86%e5%99%a8%e7%9a%84%e6%80%a7%e8%83%bd%e6%8f%90%e5%8d%87)
    - [部件间的性能平衡](#%e9%83%a8%e4%bb%b6%e9%97%b4%e7%9a%84%e6%80%a7%e8%83%bd%e5%b9%b3%e8%a1%a1)
    - [芯片组成和体系结构的改进](#%e8%8a%af%e7%89%87%e7%bb%84%e6%88%90%e5%92%8c%e4%bd%93%e7%b3%bb%e7%bb%93%e6%9e%84%e7%9a%84%e6%94%b9%e8%bf%9b)

## 结构和功能
计算机是一个复杂的系统，所以为了清楚的描述他们，我们将计算机系统表达成一个**层次系统**。
它是一系列相互关联的子系统，每个子系统又在结构上分层。对每一层，设计者应当关注其**结构**和**功能**。

- 结构：部件相互关联的方法
- 功能：作为结构组成部分的单个独立部件的操作

**自顶向下**方法，即从顶层开始，将系统分为各个子部分，往往是最清晰有效的方法。

计算机所能执行的基本功能包括**数据处理**、**数据存储**、**数据传送**和**控制**。
有文献认为，计算机的通用性是根本，所有功能专门化应当发生在编程阶段而非设计阶段。

计算机的4种主要的结构部件包括**CPU**、**主存储器**、**I/O**和**系统互连**（一个常见的例子是系统总线）。
而对于CPU，其中又包括**控制单元**、**算术逻辑单元**（ALU）、**寄存器**和**CPU内部互连**。
*可以看出互连在各级系统中都有非常重要的地位。*

## 冯·诺依曼机
1946年冯·诺依曼等提出了所谓IAS计算机，其包括主存储器、ALU、控制器额有控制机操纵的I/O设备。
IAS的存储器包括1000个存储单元（称为字），每个字长40位。此外控制器和ALU都包含了存储区域，称为寄存器，包括：

- **存储器缓冲寄存器**（MBR）：包含要写入到存储器、送到I/O或者从存储器或I/O接收的一个字。
- **存储器地址寄存器**（MAR）：指定要从MBR写入或读出到MBR的存储器地址。
- **指令寄存器**（IR）：包括正在执行的八位操作码指令。在IAS中一条指令长度为20位，包括一个8位的操作码和12位的地址。
- **指令缓冲寄存器**（IBR）：暂存来自存储器一个字的右边指令。IAS中一个字40位可以包含两条指令。
- **程序计数器**（PC）：存放下一对指令的地址；
- **累加器**（AC）和**乘商寄存器**（MQ）：暂存ALU运算的操作数结果。

IAR通过反复执行**指令周期**而运行。其包括两个子周期：

- **取值周期**：下一条指令操作码（从存储器或IBR获得）装入IR，地址装入MAR
- **执行周期**：控制电路翻译操作码，并执行指令。

IAS的指令包括**数据传送**、**无条件转移**、**条件转移**、**算术运算**和**地址修改**几种类型。

当前绝大多数计算机都具有类似的结构和功能——尽管不一定和IAS中细节完全一致。
他们都称作冯·诺依曼机。

## 计算机系统的性能设计
随着时代的发展，计算机系统的性能放生的奇迹般的提升。然而从组成和结构的角度来看，计算机系统的基本模块和50年前的IAS基本相同。
另一方面，从现有材料中挤出最后一丁点性能的技术都变得日益复杂。*可不可能通过其他方法改进性能？*

### 微处理器的性能提升

微处理器的速度显然是对计算机性能影响巨大的因素之一。除非微处理器可以不间断地接受指令
（而非经常因等待读取内存而被打断），否则微处理器不可能发挥其全部潜力。为此，当代处理器包含了以下技术：

- **转移预测**：处理器提前考察取自内存的指令代码，并预测哪条分支下一步可能会被执行。
                如果处理其大部分猜测都是正确的，就可以预取正确的指令而放入缓存，使处理器更多的时间处在繁忙之中。
                这种预测甚至可能提前预测多个分支。
- **数据流分析**：处理器通过分析哪一条指令依赖其他指令的结果和数据来优化指令调度。
                *指令的乱序执行（out-of-order execution）*
- **推测执行**：使用转移预测和数据流分析让指令在程序实际执行之前就“推测执行”并暂存结果。

以上几种技术使得处理器速度可以被充分利用。

### 部件间的性能平衡

随着处理器性能的不断提升，计算机其他部件没有及时跟上。*比如我的电脑主要性能限瓶颈其实是内存和硬盘，换了SSD之后速度快多了。*
一个最关键的地方就是处理器和主存的接口问题。有许多系统结构的方法解决这个问题，如

- 让DRAM的接口“更宽”而非“更深”，即增大总线宽度；
- 在DRAM芯片中加入高速缓存等缓冲机制；
- 在主存和处理器之间引入更复杂而有效的高速缓存，包括引入一级或多级高速缓存，以及在靠近处理器芯片的地方加入片外高速缓存；
- 通过高速总线和分层总线来缓冲和结构化数据流；

另一个方面是I/O设备的处理。为了解决在处理器和外设之间传送数据的问题，可以引入缓冲和暂存机制、使用高速互联和更精巧的总线结构等策略。
另外使用多处理器配置也有助于满足I/O需求。

综上，上面讨论的问题的关键在于平衡，包括平衡处理器部件、主存、I/O以及互连结构的吞吐量和处理要求。这里的两个重要因素是：

- 不同部件和技术领域之间性能提高的速率相差很大；
- 新的应用和外设从典型指令的描述和数据访问模式等方面不断改变对系统特性的要求。

因此计算机设计也在不断的演变。

### 芯片组成和体系结构的改进
提高处理器速度的方法可以包括：

- 提高处理器硬件速度，主要得益于逻辑门尺寸的减小和时钟频率的提升；
- 提高处理器和主存之间cache的容量和速度（尤其是片内cache）；
- 改变处理器组成和体系结构；

随着时钟速度和逻辑门密度的提升，**功耗**、**RC延迟**和**存储器滞后**等障碍会愈加显著。
其中RC延迟是指随着器件缩小，互联线变细导致电阻增大，线排列变密使得电容增加，这影响了电路的速度。
此外，对cache的提升也逐渐接近边际，目前处理器和主存之间普遍有多级cache。
另外的思路是让指令执行逻辑变得更加复杂，包括流水化和超标量化等方法。
以上的方法正在逐渐到达瓶颈，设计者逐渐转向所谓多核的方法，在同一芯片上安排多个处理器并带有很大的共享cache。
研究指出性能的提升大致正比于复杂度提升的平方根。但如果软件可以有效支持多个处理器，这种提升可能加倍。
因此对应的思路是采用更多简单的处理器，而非使处理器愈加复杂化。
此外，在片上安排更大的cache也是必要的，因为存储逻辑的功耗远小于处理器的逻辑。

